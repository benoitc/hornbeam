<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.39.1">
    <meta name="project" content="hornbeam v1.0.0">


    <title>configuration â€” hornbeam v1.0.0</title>

    <link rel="stylesheet" href="dist/html-erlang-7YNYEB7F.css" />

    <script defer src="dist/sidebar_items-DCB24D7B.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-HBZYRXZS.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="https://hornbeam.dev" class="sidebar-projectName" translate="no">
hornbeam
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.0.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of hornbeam</span>
            <div class="search-input-wrapper">
              <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
              <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
                <i class="ri-close-line ri-lg" title="Cancel search"></i>
              </button>
            </div>
          </label>
        </form>
        <div class="autocomplete">
        </div>
        <div class="engine-selector" data-multiple="false">
          <button type="button" class="engine-button" aria-label="Select search engine" aria-haspopup="true" aria-expanded="false">
            <i class="ri-search-2-line" aria-hidden="true"></i>
            <span class="engine-name">Default</span>
            <i class="ri-arrow-down-s-line" aria-hidden="true"></i>
          </button>
          <div class="engine-dropdown" hidden role="menu">

              <button type="button"
                      class="engine-option"
                      data-engine-url="search.html?q="
                      role="menuitemradio"
                      aria-checked="true">
                <span class="name">Default</span>
                <span class="help">In-browser search</span>
              </button>

          </div>
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>configuration</h1>


      <a href="https://github.com/benoitc/hornbeam/blob/v1.0.0/docs/reference/configuration.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<hr class="thin"/><p>title: Configuration Reference
description: All Hornbeam configuration options
order: 30</p><hr class="thin"/><h1>Configuration Reference</h1><p>This document covers all Hornbeam configuration options.</p><h2 id="quick-start" class="section-heading"><a href="#quick-start" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Quick Start</span></h2><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="6304060445-1">(</span><span class="s">&quot;myapp:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6304060445-2">#{</span><span class="w">
    </span><span class="ss">bind</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;0.0.0.0:8000&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">workers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="ss">worker_class</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">asgi</span><span class="w">
</span><span class="p" data-group-id="6304060445-2">}</span><span class="p" data-group-id="6304060445-1">)</span><span class="p">.</span></code></pre><h2 id="server-options" class="section-heading"><a href="#server-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Server Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">bind</code></td><td style="text-align: left;">binary/string</td><td style="text-align: left;"><code class="inline">&quot;127.0.0.1:8000&quot;</code></td><td style="text-align: left;">Address and port to bind to</td></tr><tr><td style="text-align: left;"><code class="inline">ssl</code></td><td style="text-align: left;">boolean</td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Enable SSL/TLS</td></tr><tr><td style="text-align: left;"><code class="inline">certfile</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">undefined</code></td><td style="text-align: left;">Path to SSL certificate</td></tr><tr><td style="text-align: left;"><code class="inline">keyfile</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">undefined</code></td><td style="text-align: left;">Path to SSL private key</td></tr><tr><td style="text-align: left;"><code class="inline">cacertfile</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">undefined</code></td><td style="text-align: left;">Path to CA certificate</td></tr></tbody></table><h3 id="ssl-example" class="section-heading"><a href="#ssl-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">SSL Example</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="6532014056-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6532014056-2">#{</span><span class="w">
    </span><span class="ss">bind</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;0.0.0.0:443&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">ssl</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">,</span><span class="w">
    </span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;/path/to/cert.pem&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;/path/to/key.pem&quot;</span><span class="w">
</span><span class="p" data-group-id="6532014056-2">}</span><span class="p" data-group-id="6532014056-1">)</span><span class="p">.</span></code></pre><h2 id="protocol-options" class="section-heading"><a href="#protocol-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Protocol Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">worker_class</code></td><td style="text-align: left;">atom</td><td style="text-align: left;"><code class="inline">wsgi</code></td><td style="text-align: left;">Protocol: <code class="inline">wsgi</code> or <code class="inline">asgi</code></td></tr><tr><td style="text-align: left;"><code class="inline">http_version</code></td><td style="text-align: left;">list</td><td style="text-align: left;"><code class="inline">['HTTP/1.1', 'HTTP/2']</code></td><td style="text-align: left;">Supported HTTP versions</td></tr></tbody></table><h2 id="worker-options" class="section-heading"><a href="#worker-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Worker Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">workers</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">4</code></td><td style="text-align: left;">Number of Python workers</td></tr><tr><td style="text-align: left;"><code class="inline">timeout</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">30000</code></td><td style="text-align: left;">Request timeout in milliseconds</td></tr><tr><td style="text-align: left;"><code class="inline">keepalive</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">2</code></td><td style="text-align: left;">HTTP keep-alive timeout in seconds</td></tr><tr><td style="text-align: left;"><code class="inline">max_requests</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">1000</code></td><td style="text-align: left;">Recycle worker after N requests</td></tr><tr><td style="text-align: left;"><code class="inline">preload_app</code></td><td style="text-align: left;">boolean</td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Load app before forking workers</td></tr></tbody></table><h3 id="worker-sizing" class="section-heading"><a href="#worker-sizing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Worker Sizing</span></h3><pre><code class="makeup erlang" translate="no"><span class="c1">%% CPU-bound (ML inference)</span><span class="w">
</span><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2941530284-1">(</span><span class="s">&quot;app:app&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2941530284-2">#{</span><span class="w">
    </span><span class="ss">workers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">system_info</span><span class="p" data-group-id="2941530284-3">(</span><span class="ss">schedulers</span><span class="p" data-group-id="2941530284-3">)</span><span class="w">  </span><span class="c1">% One per CPU</span><span class="w">
</span><span class="p" data-group-id="2941530284-2">}</span><span class="p" data-group-id="2941530284-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% I/O-bound (web app with DB calls)</span><span class="w">
</span><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2941530284-4">(</span><span class="s">&quot;app:app&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2941530284-5">#{</span><span class="w">
    </span><span class="ss">workers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">system_info</span><span class="p" data-group-id="2941530284-6">(</span><span class="ss">schedulers</span><span class="p" data-group-id="2941530284-6">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="2941530284-5">}</span><span class="p" data-group-id="2941530284-4">)</span><span class="p">.</span></code></pre><h2 id="asgi-options" class="section-heading"><a href="#asgi-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">ASGI Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">lifespan</code></td><td style="text-align: left;">atom</td><td style="text-align: left;"><code class="inline">auto</code></td><td style="text-align: left;">Lifespan handling: <code class="inline">auto</code>, <code class="inline">on</code>, <code class="inline">off</code></td></tr><tr><td style="text-align: left;"><code class="inline">root_path</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">&quot;&quot;</code></td><td style="text-align: left;">ASGI root_path for mounted apps</td></tr></tbody></table><h3 id="lifespan-values" class="section-heading"><a href="#lifespan-values" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Lifespan Values</span></h3><ul><li><code class="inline">auto</code> - Detect if app supports lifespan, use if available</li><li><code class="inline">on</code> - Require lifespan, fail if app doesn't support it</li><li><code class="inline">off</code> - Disable lifespan even if app supports it</li></ul><h2 id="websocket-options" class="section-heading"><a href="#websocket-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">WebSocket Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">websocket_timeout</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">60000</code></td><td style="text-align: left;">WebSocket idle timeout (ms)</td></tr><tr><td style="text-align: left;"><code class="inline">websocket_max_frame_size</code></td><td style="text-align: left;">integer</td><td style="text-align: left;"><code class="inline">16777216</code></td><td style="text-align: left;">Max frame size (16MB)</td></tr><tr><td style="text-align: left;"><code class="inline">websocket_compress</code></td><td style="text-align: left;">boolean</td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Enable WebSocket compression</td></tr></tbody></table><h2 id="python-options" class="section-heading"><a href="#python-options" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Python Options</span></h2><table><thead><tr><th style="text-align: left;">Option</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">pythonpath</code></td><td style="text-align: left;">list</td><td style="text-align: left;"><code class="inline">[&quot;.&quot;, &quot;examples&quot;]</code></td><td style="text-align: left;">Python module search paths</td></tr><tr><td style="text-align: left;"><code class="inline">python_home</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">undefined</code></td><td style="text-align: left;">Python home directory</td></tr><tr><td style="text-align: left;"><code class="inline">venv</code></td><td style="text-align: left;">binary</td><td style="text-align: left;"><code class="inline">undefined</code></td><td style="text-align: left;">Virtual environment path</td></tr></tbody></table><h3 id="virtual-environment" class="section-heading"><a href="#virtual-environment" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Virtual Environment</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="9644711564-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9644711564-2">#{</span><span class="w">
    </span><span class="ss">venv</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;/path/to/myproject/venv&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">pythonpath</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9644711564-3">[</span><span class="s">&quot;/path/to/myproject&quot;</span><span class="p" data-group-id="9644711564-3">]</span><span class="w">
</span><span class="p" data-group-id="9644711564-2">}</span><span class="p" data-group-id="9644711564-1">)</span><span class="p">.</span></code></pre><h2 id="hooks" class="section-heading"><a href="#hooks" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Hooks</span></h2><p>Hooks allow you to execute Erlang code at key points in the request lifecycle.</p><table><thead><tr><th style="text-align: left;">Hook</th><th style="text-align: left;">Arguments</th><th style="text-align: left;">Return</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">on_request</code></td><td style="text-align: left;"><code class="inline">Request</code></td><td style="text-align: left;"><code class="inline">Request</code></td><td style="text-align: left;">Called before handling request</td></tr><tr><td style="text-align: left;"><code class="inline">on_response</code></td><td style="text-align: left;"><code class="inline">Response</code></td><td style="text-align: left;"><code class="inline">Response</code></td><td style="text-align: left;">Called before sending response</td></tr><tr><td style="text-align: left;"><code class="inline">on_error</code></td><td style="text-align: left;"><code class="inline">Error, Request</code></td><td style="text-align: left;"><code class="inline">{Code, Body}</code></td><td style="text-align: left;">Called on error</td></tr><tr><td style="text-align: left;"><code class="inline">on_worker_start</code></td><td style="text-align: left;"><code class="inline">WorkerId</code></td><td style="text-align: left;"><code class="inline">ok</code></td><td style="text-align: left;">Called when worker starts</td></tr><tr><td style="text-align: left;"><code class="inline">on_worker_exit</code></td><td style="text-align: left;"><code class="inline">WorkerId, Reason</code></td><td style="text-align: left;"><code class="inline">ok</code></td><td style="text-align: left;">Called when worker exits</td></tr></tbody></table><h3 id="hook-examples" class="section-heading"><a href="#hook-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Hook Examples</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="6031314000-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-2">#{</span><span class="w">
    </span><span class="ss">hooks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6031314000-3">#{</span><span class="w">
        </span><span class="c1">%% Request hook: logging, authentication, rate limiting</span><span class="w">
        </span><span class="ss">on_request</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6031314000-4">(</span><span class="n">Request</span><span class="p" data-group-id="6031314000-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="6031314000-5">#{</span><span class="ss">method</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="ss">path</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Path</span><span class="p" data-group-id="6031314000-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">,</span><span class="w">
            </span><span class="nc">logger</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="6031314000-6">(</span><span class="s">&quot;</span><span class="si">~s</span><span class="s"> </span><span class="si">~s</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-7">[</span><span class="n">Method</span><span class="p">,</span><span class="w"> </span><span class="n">Path</span><span class="p" data-group-id="6031314000-7">]</span><span class="p" data-group-id="6031314000-6">)</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Add custom header</span><span class="w">
            </span><span class="n">Headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">maps</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="6031314000-8">(</span><span class="ss">headers</span><span class="p">,</span><span class="w"> </span><span class="n">Request</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-9">#{</span><span class="p" data-group-id="6031314000-9">}</span><span class="p" data-group-id="6031314000-8">)</span><span class="p">,</span><span class="w">
            </span><span class="n">Request</span><span class="p" data-group-id="6031314000-10">#{</span><span class="ss">headers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Headers</span><span class="p" data-group-id="6031314000-11">#{</span><span class="p" data-group-id="6031314000-12">&lt;&lt;</span><span class="s">&quot;x-request-id&quot;</span><span class="p" data-group-id="6031314000-12">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">generate_id</span><span class="p" data-group-id="6031314000-13">(</span><span class="p" data-group-id="6031314000-13">)</span><span class="p" data-group-id="6031314000-11">}</span><span class="p" data-group-id="6031314000-10">}</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="c1">%% Response hook: add headers, log response</span><span class="w">
        </span><span class="ss">on_response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6031314000-14">(</span><span class="n">Response</span><span class="p" data-group-id="6031314000-14">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="6031314000-15">#{</span><span class="ss">status</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Status</span><span class="p" data-group-id="6031314000-15">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Response</span><span class="p">,</span><span class="w">
            </span><span class="nc">metrics</span><span class="p">:</span><span class="nf">incr</span><span class="p" data-group-id="6031314000-16">(</span><span class="p" data-group-id="6031314000-17">&lt;&lt;</span><span class="s">&quot;response_&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-18">(</span><span class="nf">integer_to_binary</span><span class="p" data-group-id="6031314000-19">(</span><span class="n">Status</span><span class="p" data-group-id="6031314000-19">)</span><span class="p" data-group-id="6031314000-18">)</span><span class="o">/</span><span class="ss">binary</span><span class="p" data-group-id="6031314000-17">&gt;&gt;</span><span class="p" data-group-id="6031314000-16">)</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Add server header</span><span class="w">
            </span><span class="n">Headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">maps</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="6031314000-20">(</span><span class="ss">headers</span><span class="p">,</span><span class="w"> </span><span class="n">Response</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-21">#{</span><span class="p" data-group-id="6031314000-21">}</span><span class="p" data-group-id="6031314000-20">)</span><span class="p">,</span><span class="w">
            </span><span class="n">Response</span><span class="p" data-group-id="6031314000-22">#{</span><span class="ss">headers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">Headers</span><span class="p" data-group-id="6031314000-23">#{</span><span class="p" data-group-id="6031314000-24">&lt;&lt;</span><span class="s">&quot;x-powered-by&quot;</span><span class="p" data-group-id="6031314000-24">&gt;&gt;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6031314000-25">&lt;&lt;</span><span class="s">&quot;Hornbeam&quot;</span><span class="p" data-group-id="6031314000-25">&gt;&gt;</span><span class="p" data-group-id="6031314000-23">}</span><span class="p" data-group-id="6031314000-22">}</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="c1">%% Error hook: custom error handling</span><span class="w">
        </span><span class="ss">on_error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6031314000-26">(</span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">Request</span><span class="p" data-group-id="6031314000-26">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="6031314000-27">#{</span><span class="ss">path</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Path</span><span class="p" data-group-id="6031314000-27">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">,</span><span class="w">
            </span><span class="nc">logger</span><span class="p">:</span><span class="nf">error</span><span class="p" data-group-id="6031314000-28">(</span><span class="s">&quot;Error on </span><span class="si">~s</span><span class="s">: </span><span class="si">~p</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-29">[</span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p" data-group-id="6031314000-29">]</span><span class="p" data-group-id="6031314000-28">)</span><span class="p">,</span><span class="w">

            </span><span class="k">case</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="k">of</span><span class="w">
                </span><span class="p" data-group-id="6031314000-30">{</span><span class="ss">timeout</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="6031314000-30">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="6031314000-31">{</span><span class="mi">504</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-32">&lt;&lt;</span><span class="s">&quot;Gateway Timeout&quot;</span><span class="p" data-group-id="6031314000-32">&gt;&gt;</span><span class="p" data-group-id="6031314000-31">}</span><span class="p">;</span><span class="w">
                </span><span class="p" data-group-id="6031314000-33">{</span><span class="ss">python_error</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="6031314000-33">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="6031314000-34">{</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nf">iolist_to_binary</span><span class="p" data-group-id="6031314000-35">(</span><span class="nc">io_lib</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="6031314000-36">(</span><span class="s">&quot;</span><span class="si">~p</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-37">[</span><span class="n">Reason</span><span class="p" data-group-id="6031314000-37">]</span><span class="p" data-group-id="6031314000-36">)</span><span class="p" data-group-id="6031314000-35">)</span><span class="p" data-group-id="6031314000-34">}</span><span class="p">;</span><span class="w">
                </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="6031314000-38">{</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-39">&lt;&lt;</span><span class="s">&quot;Internal Server Error&quot;</span><span class="p" data-group-id="6031314000-39">&gt;&gt;</span><span class="p" data-group-id="6031314000-38">}</span><span class="w">
            </span><span class="k">end</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="c1">%% Worker lifecycle hooks</span><span class="w">
        </span><span class="ss">on_worker_start</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6031314000-40">(</span><span class="n">WorkerId</span><span class="p" data-group-id="6031314000-40">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">logger</span><span class="p">:</span><span class="nf">info</span><span class="p" data-group-id="6031314000-41">(</span><span class="s">&quot;Worker </span><span class="si">~p</span><span class="s"> started&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-42">[</span><span class="n">WorkerId</span><span class="p" data-group-id="6031314000-42">]</span><span class="p" data-group-id="6031314000-41">)</span><span class="p">,</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="ss">on_worker_exit</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="6031314000-43">(</span><span class="n">WorkerId</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="6031314000-43">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">logger</span><span class="p">:</span><span class="nf">warning</span><span class="p" data-group-id="6031314000-44">(</span><span class="s">&quot;Worker </span><span class="si">~p</span><span class="s"> exited: </span><span class="si">~p</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6031314000-45">[</span><span class="n">WorkerId</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="6031314000-45">]</span><span class="p" data-group-id="6031314000-44">)</span><span class="p">,</span><span class="w">
            </span><span class="ss">ok</span><span class="w">
        </span><span class="k">end</span><span class="w">
    </span><span class="p" data-group-id="6031314000-3">}</span><span class="w">
</span><span class="p" data-group-id="6031314000-2">}</span><span class="p" data-group-id="6031314000-1">)</span><span class="p">.</span></code></pre><h3 id="authentication-hook" class="section-heading"><a href="#authentication-hook" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Authentication Hook</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8710545612-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8710545612-2">#{</span><span class="w">
    </span><span class="ss">hooks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="8710545612-3">#{</span><span class="w">
        </span><span class="ss">on_request</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="8710545612-4">(</span><span class="n">Request</span><span class="p" data-group-id="8710545612-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="8710545612-5">#{</span><span class="ss">headers</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Headers</span><span class="p">,</span><span class="w"> </span><span class="ss">path</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Path</span><span class="p" data-group-id="8710545612-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Skip auth for public paths</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="k">of</span><span class="w">
                </span><span class="p" data-group-id="8710545612-6">&lt;&lt;</span><span class="s">&quot;/health&quot;</span><span class="p" data-group-id="8710545612-6">&gt;&gt;</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Request</span><span class="p">;</span><span class="w">
                </span><span class="p" data-group-id="8710545612-7">&lt;&lt;</span><span class="s">&quot;/public/&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="o">/</span><span class="ss">binary</span><span class="p" data-group-id="8710545612-7">&gt;&gt;</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Request</span><span class="p">;</span><span class="w">
                </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="k">case</span><span class="w"> </span><span class="nc">maps</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="8710545612-8">(</span><span class="p" data-group-id="8710545612-9">&lt;&lt;</span><span class="s">&quot;authorization&quot;</span><span class="p" data-group-id="8710545612-9">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Headers</span><span class="p">,</span><span class="w"> </span><span class="ss">undefined</span><span class="p" data-group-id="8710545612-8">)</span><span class="w"> </span><span class="k">of</span><span class="w">
                        </span><span class="ss">undefined</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                            </span><span class="nf">throw</span><span class="p" data-group-id="8710545612-10">(</span><span class="p" data-group-id="8710545612-11">{</span><span class="ss">unauthorized</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8710545612-12">&lt;&lt;</span><span class="s">&quot;Missing authorization header&quot;</span><span class="p" data-group-id="8710545612-12">&gt;&gt;</span><span class="p" data-group-id="8710545612-11">}</span><span class="p" data-group-id="8710545612-10">)</span><span class="p">;</span><span class="w">
                        </span><span class="n">Token</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                            </span><span class="k">case</span><span class="w"> </span><span class="nc">auth</span><span class="p">:</span><span class="nf">verify_token</span><span class="p" data-group-id="8710545612-13">(</span><span class="n">Token</span><span class="p" data-group-id="8710545612-13">)</span><span class="w"> </span><span class="k">of</span><span class="w">
                                </span><span class="p" data-group-id="8710545612-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">UserId</span><span class="p" data-group-id="8710545612-14">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                    </span><span class="n">Request</span><span class="p" data-group-id="8710545612-15">#{</span><span class="ss">user_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">UserId</span><span class="p" data-group-id="8710545612-15">}</span><span class="p">;</span><span class="w">
                                </span><span class="p" data-group-id="8710545612-16">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="8710545612-16">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                                    </span><span class="nf">throw</span><span class="p" data-group-id="8710545612-17">(</span><span class="p" data-group-id="8710545612-18">{</span><span class="ss">unauthorized</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8710545612-19">&lt;&lt;</span><span class="s">&quot;Invalid token&quot;</span><span class="p" data-group-id="8710545612-19">&gt;&gt;</span><span class="p" data-group-id="8710545612-18">}</span><span class="p" data-group-id="8710545612-17">)</span><span class="w">
                            </span><span class="k">end</span><span class="w">
                    </span><span class="k">end</span><span class="w">
            </span><span class="k">end</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="ss">on_error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="8710545612-20">(</span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Request</span><span class="p" data-group-id="8710545612-20">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="k">of</span><span class="w">
                </span><span class="p" data-group-id="8710545612-21">{</span><span class="ss">unauthorized</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="8710545612-21">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="8710545612-22">{</span><span class="mi">401</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="8710545612-22">}</span><span class="p">;</span><span class="w">
                </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="8710545612-23">{</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8710545612-24">&lt;&lt;</span><span class="s">&quot;Internal Server Error&quot;</span><span class="p" data-group-id="8710545612-24">&gt;&gt;</span><span class="p" data-group-id="8710545612-23">}</span><span class="w">
            </span><span class="k">end</span><span class="w">
        </span><span class="k">end</span><span class="w">
    </span><span class="p" data-group-id="8710545612-3">}</span><span class="w">
</span><span class="p" data-group-id="8710545612-2">}</span><span class="p" data-group-id="8710545612-1">)</span><span class="p">.</span></code></pre><h3 id="rate-limiting-hook" class="section-heading"><a href="#rate-limiting-hook" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Rate Limiting Hook</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="0173960031-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0173960031-2">#{</span><span class="w">
    </span><span class="ss">hooks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0173960031-3">#{</span><span class="w">
        </span><span class="ss">on_request</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="0173960031-4">(</span><span class="n">Request</span><span class="p" data-group-id="0173960031-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="0173960031-5">#{</span><span class="ss">headers</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Headers</span><span class="p" data-group-id="0173960031-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="p">,</span><span class="w">
            </span><span class="n">ClientIP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">maps</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="0173960031-6">(</span><span class="p" data-group-id="0173960031-7">&lt;&lt;</span><span class="s">&quot;x-forwarded-for&quot;</span><span class="p" data-group-id="0173960031-7">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Headers</span><span class="p">,</span><span class="w">
                                </span><span class="nc">maps</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="0173960031-8">(</span><span class="p" data-group-id="0173960031-9">&lt;&lt;</span><span class="s">&quot;x-real-ip&quot;</span><span class="p" data-group-id="0173960031-9">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Headers</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0173960031-10">&lt;&lt;</span><span class="s">&quot;unknown&quot;</span><span class="p" data-group-id="0173960031-10">&gt;&gt;</span><span class="p" data-group-id="0173960031-8">)</span><span class="p" data-group-id="0173960031-6">)</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Rate limit key</span><span class="w">
            </span><span class="n">Minute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">calendar</span><span class="p">:</span><span class="nf">datetime_to_gregorian_seconds</span><span class="p" data-group-id="0173960031-11">(</span><span class="nc">calendar</span><span class="p">:</span><span class="nf">universal_time</span><span class="p" data-group-id="0173960031-12">(</span><span class="p" data-group-id="0173960031-12">)</span><span class="p" data-group-id="0173960031-11">)</span><span class="w"> </span><span class="ow">div</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
            </span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0173960031-13">{</span><span class="ss">rate_limit</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP</span><span class="p">,</span><span class="w"> </span><span class="n">Minute</span><span class="p" data-group-id="0173960031-13">}</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Check and increment</span><span class="w">
            </span><span class="n">Count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ets</span><span class="p">:</span><span class="nf">update_counter</span><span class="p" data-group-id="0173960031-14">(</span><span class="ss">rate_limits</span><span class="p">,</span><span class="w"> </span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0173960031-15">{</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="0173960031-15">}</span><span class="p" data-group-id="0173960031-14">)</span><span class="p">,</span><span class="w">

            </span><span class="k">if</span><span class="w">
                </span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="nf">throw</span><span class="p" data-group-id="0173960031-16">(</span><span class="p" data-group-id="0173960031-17">{</span><span class="ss">rate_limited</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0173960031-18">&lt;&lt;</span><span class="s">&quot;Too many requests&quot;</span><span class="p" data-group-id="0173960031-18">&gt;&gt;</span><span class="p" data-group-id="0173960031-17">}</span><span class="p" data-group-id="0173960031-16">)</span><span class="p">;</span><span class="w">
                </span><span class="ss">true</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="n">Request</span><span class="w">
            </span><span class="k">end</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="ss">on_error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="0173960031-19">(</span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Request</span><span class="p" data-group-id="0173960031-19">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="k">of</span><span class="w">
                </span><span class="p" data-group-id="0173960031-20">{</span><span class="ss">rate_limited</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="0173960031-20">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="0173960031-21">{</span><span class="mi">429</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="0173960031-21">}</span><span class="p">;</span><span class="w">
                </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                    </span><span class="p" data-group-id="0173960031-22">{</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0173960031-23">&lt;&lt;</span><span class="s">&quot;Internal Server Error&quot;</span><span class="p" data-group-id="0173960031-23">&gt;&gt;</span><span class="p" data-group-id="0173960031-22">}</span><span class="w">
            </span><span class="k">end</span><span class="w">
        </span><span class="k">end</span><span class="w">
    </span><span class="p" data-group-id="0173960031-3">}</span><span class="w">
</span><span class="p" data-group-id="0173960031-2">}</span><span class="p" data-group-id="0173960031-1">)</span><span class="p">.</span></code></pre><h3 id="metrics-hook" class="section-heading"><a href="#metrics-hook" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Metrics Hook</span></h3><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="7163478686-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7163478686-2">#{</span><span class="w">
    </span><span class="ss">hooks</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7163478686-3">#{</span><span class="w">
        </span><span class="ss">on_request</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7163478686-4">(</span><span class="n">Request</span><span class="p" data-group-id="7163478686-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="c1">%% Start timing</span><span class="w">
            </span><span class="n">Request</span><span class="p" data-group-id="7163478686-5">#{</span><span class="ss">start_time</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">monotonic_time</span><span class="p" data-group-id="7163478686-6">(</span><span class="ss">microsecond</span><span class="p" data-group-id="7163478686-6">)</span><span class="p" data-group-id="7163478686-5">}</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

        </span><span class="ss">on_response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7163478686-7">(</span><span class="n">Response</span><span class="p" data-group-id="7163478686-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="7163478686-8">#{</span><span class="ss">start_time</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">StartTime</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Status</span><span class="p">,</span><span class="w"> </span><span class="ss">path</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="n">Path</span><span class="p" data-group-id="7163478686-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Response</span><span class="p">,</span><span class="w">
            </span><span class="n">Duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">monotonic_time</span><span class="p" data-group-id="7163478686-9">(</span><span class="ss">microsecond</span><span class="p" data-group-id="7163478686-9">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">StartTime</span><span class="p">,</span><span class="w">

            </span><span class="c1">%% Record metrics</span><span class="w">
            </span><span class="nc">prometheus_histogram</span><span class="p">:</span><span class="nf">observe</span><span class="p" data-group-id="7163478686-10">(</span><span class="w">
                </span><span class="ss">http_request_duration_microseconds</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="7163478686-11">[</span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">Status</span><span class="p" data-group-id="7163478686-11">]</span><span class="p">,</span><span class="w">
                </span><span class="n">Duration</span><span class="w">
            </span><span class="p" data-group-id="7163478686-10">)</span><span class="p">,</span><span class="w">

            </span><span class="n">Response</span><span class="w">
        </span><span class="k">end</span><span class="w">
    </span><span class="p" data-group-id="7163478686-3">}</span><span class="w">
</span><span class="p" data-group-id="7163478686-2">}</span><span class="p" data-group-id="7163478686-1">)</span><span class="p">.</span></code></pre><h2 id="sys-config" class="section-heading"><a href="#sys-config" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">sys.config</span></h2><p>Configure via sys.config for releases:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% config/sys.config</span><span class="w">
</span><span class="p" data-group-id="1057037940-1">[</span><span class="w">
    </span><span class="p" data-group-id="1057037940-2">{</span><span class="ss">hornbeam</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1057037940-3">[</span><span class="w">
        </span><span class="p" data-group-id="1057037940-4">{</span><span class="ss">bind</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.0.0.0:8000&quot;</span><span class="p" data-group-id="1057037940-4">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-5">{</span><span class="ss">workers</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="1057037940-5">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-6">{</span><span class="ss">worker_class</span><span class="p">,</span><span class="w"> </span><span class="ss">asgi</span><span class="p" data-group-id="1057037940-6">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-7">{</span><span class="ss">timeout</span><span class="p">,</span><span class="w"> </span><span class="mi">30000</span><span class="p" data-group-id="1057037940-7">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-8">{</span><span class="ss">lifespan</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p" data-group-id="1057037940-8">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-9">{</span><span class="ss">pythonpath</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1057037940-10">[</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;src&quot;</span><span class="p" data-group-id="1057037940-10">]</span><span class="p" data-group-id="1057037940-9">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="1057037940-11">{</span><span class="ss">websocket_timeout</span><span class="p">,</span><span class="w"> </span><span class="mi">120000</span><span class="p" data-group-id="1057037940-11">}</span><span class="w">
    </span><span class="p" data-group-id="1057037940-3">]</span><span class="p" data-group-id="1057037940-2">}</span><span class="w">
</span><span class="p" data-group-id="1057037940-1">]</span><span class="p">.</span></code></pre><p>Then start without options:</p><pre><code class="makeup erlang" translate="no"><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="0893184742-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p" data-group-id="0893184742-1">)</span><span class="p">.</span></code></pre><h2 id="environment-variables" class="section-heading"><a href="#environment-variables" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Environment Variables</span></h2><pre><code class="makeup bash" translate="no"><span class=""># Set via environment
</span><span class="">export HORNBEAM_BIND=&quot;0.0.0.0:8000&quot;
</span><span class="">export HORNBEAM_WORKERS=8
</span><span class="">export HORNBEAM_TIMEOUT=30000
</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="c1">%% Read from environment</span><span class="w">
</span><span class="nc">hornbeam</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8516814778-1">(</span><span class="s">&quot;app:application&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8516814778-2">#{</span><span class="w">
    </span><span class="ss">bind</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">os</span><span class="p">:</span><span class="nf">getenv</span><span class="p" data-group-id="8516814778-3">(</span><span class="s">&quot;HORNBEAM_BIND&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;127.0.0.1:8000&quot;</span><span class="p" data-group-id="8516814778-3">)</span><span class="p">,</span><span class="w">
    </span><span class="ss">workers</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nf">list_to_integer</span><span class="p" data-group-id="8516814778-4">(</span><span class="nc">os</span><span class="p">:</span><span class="nf">getenv</span><span class="p" data-group-id="8516814778-5">(</span><span class="s">&quot;HORNBEAM_WORKERS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="p" data-group-id="8516814778-5">)</span><span class="p" data-group-id="8516814778-4">)</span><span class="w">
</span><span class="p" data-group-id="8516814778-2">}</span><span class="p" data-group-id="8516814778-1">)</span><span class="p">.</span></code></pre><h2 id="next-steps" class="section-heading"><a href="#next-steps" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Next Steps</span></h2><ul><li><a href="./erlang-api">Erlang API Reference</a> - All Erlang modules</li><li><a href="./python-api">Python API Reference</a> - All Python modules</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="distributed-ml.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
distributed-ml
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/hornbeam/1.0.0" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/hornbeam/1.0.0">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/hornbeam/1.0.0/show/docs/reference/configuration.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="hornbeam.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.39.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
